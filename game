<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Carbon Cleanup Mini Game</title>
<style>
body { font-family: Arial; background: linear-gradient(135deg, #0f1a3c, #0fae8f); color:white; display:flex; flex-direction:column; align-items:center; padding:20px; min-height:100vh; }
h2 { margin-bottom: 10px; }
canvas { background: #222; border-radius: 10px; margin-bottom: 15px; }
button.task-btn { width: 250px; padding: 10px; margin: 5px; font-size: 1em; border-radius: 8px; border: none; cursor: pointer; background: #198754; color: white; }
button.task-btn:disabled { background: gray; cursor: default; }
#status { font-size: 1.2em; margin-bottom: 15px; }
a.back-button { margin-top: 20px; padding: 10px 20px; background: #14532d; color: white; border-radius: 8px; text-decoration: none; }
a.back-button:hover { background: #0f3c1e; }
</style>
</head>
<body>

<h2>Carbon Cleanup Mini Game</h2>
<canvas id="carCanvas" width="800" height="360"></canvas>
<div id="status"></div>
<div id="tasks"></div>
<a href="/personal" class="back-button">Back to Carbon Footprint Calculator</a>

<script>
const canvas = document.getElementById('carCanvas');
const ctx = canvas.getContext('2d');
const statusDiv = document.getElementById('status');
const tasksDiv = document.getElementById('tasks');

let stage = 1;
let tasksCompleted = 0;
const TASKS_PER_STAGE = 2;

const stageTasks = {
    1: ["Use Public Transport","Walk or Cycle"],
    2: ["Save Electricity","Use LED Lights"],
    3: ["Plant Trees","Recycle Waste"],
};

const stageStatus = {
    1: "The car is heavily polluted",
    2: "The car is getting cleaner",
    3: "The car is almost clean",
    4: "The car is fully clean"
};

function drawCar() {
    ctx.clearRect(0,0,canvas.width, canvas.height);

    let carColor;
    if(stage==1) carColor="#444";
    else if(stage==2) carColor="#777";
    else if(stage==3) carColor="#aaa";
    else carColor="green";

    // car body
    ctx.fillStyle = carColor;
    ctx.fillRect(250,180,300,70);
    ctx.fillRect(320,150,160,30);

    // wheels
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(305,275,25,0,Math.PI*2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(495,275,25,0,Math.PI*2);
    ctx.fill();

    // car damage marks
    if(stage<=2){
        ctx.strokeStyle="black";
        ctx.lineWidth=3;
        ctx.beginPath();
        ctx.arc(400,222,15,0,Math.PI*2);
        ctx.stroke();
    }
    if(stage==1){
        ctx.beginPath();
        ctx.moveTo(300,215);
        ctx.lineTo(350,225);
        ctx.stroke();
    }

    statusDiv.textContent = stageStatus[stage] || "";
}

function loadTasks() {
    tasksDiv.innerHTML = "";
    if(stage > 3){
        tasksDiv.innerHTML = "<p style='color: lightgreen;'>All tasks completed! ðŸŒ±</p>";
        return;
    }
    stageTasks[stage].forEach(task => {
        const btn = document.createElement("button");
        btn.textContent = task;
        btn.className = "task-btn";
        btn.onclick = () => completeTask(btn);
        tasksDiv.appendChild(btn);
    });
}

function completeTask(btn){
    btn.disabled = true;
    btn.textContent = "Completed";
    tasksCompleted++;

    if(tasksCompleted >= TASKS_PER_STAGE){
        tasksCompleted = 0;
        stage++;
        drawCar();
        loadTasks();
    }
}

// initialize
drawCar();
loadTasks();

</script>

</body>
</html>
